<?xml version="1.0" encoding="UTF-8"?> <xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:srw="http://www.loc.gov/zing/srw/" xmlns:srw_dc="info:srw/schema/1/dc-v1.1" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:mods="http://www.loc.gov/mods/v3"> 

<xsl:param name="content-date"/> <xsl:output method="text" encoding="iso-8859-1"/> <xsl:strip-space elements="*" /> <xsl:template match="/"> <xsl:text>SENDER,SENDER_GND,RECEIVER,RECEIVER_GND,DATE (Y-M-D),SENT FROM,LANGUAGE,LIBRARY/ARCHIVE,FULL SHELFMARK,Kalliope Verbund URI,SUMMARY,MENTIONED GNDs&#10;</xsl:text> <xsl:for-each select="srw:searchRetrieveResponse/srw:records/srw:record/srw:recordData/mods:mods">"<xsl:value-of select="mods:name[mods:role/mods:roleTerm='cre']/mods:namePart"/>","<xsl:value-of select="substring-after(mods:name[mods:role/mods:roleTerm='cre']/@valueURI, 'https://d-nb.info/gnd/')"/>","<xsl:value-of select="mods:name[mods:role/mods:roleTerm='rcp']/mods:namePart"/>","<xsl:value-of select="substring-after(mods:name[mods:role/mods:roleTerm='rcp']/@valueURI, 'https://d-nb.info/gnd/')"/>","<xsl:value-of select="mods:originInfo/mods:dateCreated[@encoding='w3cdtf']"/>","<xsl:value-of select="mods:originInfo/mods:place/mods:placeTerm"/>","<xsl:call-template name="language-code2string">     <xsl:with-param name="code" select="mods:language/mods:languageTerm[@authority='iso639-2b']" /> </xsl:call-template>","<xsl:value-of select="mods:location/mods:physicalLocation"/>","<xsl:value-of select="mods:location/mods:physicalLocation"/>, <xsl:value-of select="mods:location/mods:shelfLocator"/>","<xsl:value-of select="mods:identifier[@type='uri']"/>","<xsl:call-template name="string-replace-all">     <xsl:with-param name="text" select="mods:abstract[@type='content']" />     <xsl:with-param name="replace" select="'&quot;'" />     <xsl:with-param name="by" select="'&quot;&quot;'" /> </xsl:call-template> <xsl:choose>     <xsl:when test="mods:name[mods:role/mods:roleTerm='Erwähnt']">         <xsl:text> Mentions Individual(s): </xsl:text>         <xsl:for-each select="mods:name[mods:role/mods:roleTerm='Erwähnt']">             <xsl:if test="position() > 1"><xsl:text>; </xsl:text></xsl:if>             <xsl:value-of select="mods:namePart"/>         </xsl:for-each>     </xsl:when>     <xsl:otherwise>         <xsl:text> Does not mention Individuals</xsl:text>     </xsl:otherwise> </xsl:choose> <xsl:choose>     <xsl:when test="mods:name[mods:role/mods:roleTerm='Dokumentiert']">         <xsl:text>. Mentions Publication(s): </xsl:text>         <xsl:for-each select="mods:name[mods:role/mods:roleTerm='Dokumentiert']">             <xsl:if test="position() > 1"><xsl:text>; </xsl:text></xsl:if>             <xsl:value-of select="mods:namePart"/>         </xsl:for-each>     </xsl:when>     <xsl:otherwise>         <xsl:text>. Does not mention Publications</xsl:text>     </xsl:otherwise> </xsl:choose> <xsl:text>. Information retrieved from Kalliope record, last modified on </xsl:text> <xsl:value-of select="substring(mods:recordInfo/mods:recordChangeDate[@encoding='w3cdtf'], 1, 10)"/><xsl:text>. Exported on </xsl:text><xsl:value-of select="$content-date"/>.","<xsl:choose>     <xsl:when test="mods:name[mods:role/mods:roleTerm='Erwähnt']">         <xsl:for-each select="mods:name[mods:role/mods:roleTerm='Erwähnt']">             <xsl:if test="position() > 1"><xsl:text>;</xsl:text></xsl:if>             <xsl:value-of select="@valueURI"/>          </xsl:for-each>     </xsl:when>     <xsl:otherwise>         <xsl:text>Does not mention Individuals</xsl:text>     </xsl:otherwise> </xsl:choose> <xsl:for-each select="//name[role/roleTerm='Erwähnt']">             <xsl:value-of select="@valueURI"/>         </xsl:for-each>", </xsl:for-each> </xsl:template>   <xsl:template name="string-replace-all">   <xsl:param name="text" />   <xsl:param name="replace" />   <xsl:param name="by" />   <xsl:choose>     <xsl:when test="contains($text, $replace)">       <xsl:value-of select="substring-before($text,$replace)" />       <xsl:value-of select="$by" />       <xsl:call-template name="string-replace-all">         <xsl:with-param name="text" select="substring-after($text,$replace)" />         <xsl:with-param name="replace" select="$replace" />         <xsl:with-param name="by" select="$by" />       </xsl:call-template>     </xsl:when>     <xsl:otherwise>       <xsl:value-of select="$text" />     </xsl:otherwise>   </xsl:choose> </xsl:template>   <xsl:template name="language-code2string">   <xsl:param name="code" />   <xsl:choose>     <xsl:when test="$code = 'eng'">       <xsl:value-of select="'English'" />     </xsl:when>     <xsl:when test="$code = 'ger'">       <xsl:value-of select="'German'" />     </xsl:when>      <xsl:otherwise>       <xsl:value-of select="$code" />     </xsl:otherwise>   </xsl:choose> </xsl:template> </xsl:stylesheet> 